CREATE OR REPLACE PROCEDURE ISENROLLABLE(STUDENTID IN VARCHAR2,COURSEID IN VARCHAR2,INSTRID IN VARCHAR2,  GRADE IN VARCHAR2,
SESSIONID IN VARCHAR2,STATUS IN VARCHAR2,CREDITS IN INTEGER, SUCCESS OUT INTEGER, ISSUE OUT VARCHAR2)
AS
STU_GPA FLOAT;
REQ_GPA FLOAT;
SPL_PERM VARCHAR2(30);
PREREQ_CHECK NUMBER;
BEGIN
  --GPA REQUIREMENT CHECK
  SELECT GPA INTO STU_GPA FROM STUDENT WHERE STUDENT_ID LIKE STUDENTID;
  SELECT MIN_GPA INTO REQ_GPA FROM COURSES WHERE COURSE_ID LIKE COURSEID;
  IF STU_GPA<REQ_GPA THEN
  ISSUE := 'STUDENT GPA REQUIREMENT IS NOT SATISFIED FOR THIS COURSE';
  SUCCESS := 1;
  RETURN;
  ELSE
  SUCCESS := 0;
  END IF;
  --GPA REQUIREMENT CHECK - END
  
  
  SELECT SPECIAL_PERM INTO SPL_PERM FROM COURSES WHERE COURSE_ID LIKE COURSEID;
  --DBMS_OUTPUT.PUT_LINE(SPL_PERM);
  IF SPL_PERM LIKE 'NONE' THEN
    SUCCESS := 0;
  ELSIF SPL_PERM LIKE 'PREREQ' THEN
  SELECT COUNT(*) INTO PREREQ_CHECK FROM PREREQ WHERE COURSE_ID LIKE COURSEID AND PREREQ_CID NOT IN 
  (SELECT COURSE_ID FROM ENROLLMENT WHERE STUDENT_ID LIKE STUDENTID);
    IF PREREQ_CHECK>0 THEN
      ISSUE := 'ENROLLMENT ERROR : STUDENT HAS NOT TAKEN ALL PREREQUISITE COURSES';
      SUCCESS :=1;
      RETURN;
    ELSE
    SUCCESS := 0;
    END IF;
  
  ELSIF SPL_PERM LIKE 'SPP' THEN
  --SPECIAL PERMISSION ROW ADDED TO PENDING_PERMISSION
  INSERT INTO PENDING_PERMISSIONS("COURSE_ID","STUDENT_ID") VALUES(COURSEID,STUDENTID);
  SUCCESS := 2;
  ISSUE := 'SPECIAL PERMISSION REQUEST SENT TO DEPARTMENT';
  
  ELSIF SPL_PERM LIKE 'SPPERM' THEN
  --DBMS_OUTPUT.PUT_LINE('NO SPL PERMISSION REQUIRED');
  SELECT COUNT(*) INTO PREREQ_CHECK FROM PREREQ WHERE COURSE_ID LIKE COURSEID AND PREREQ_CID NOT IN 
  (SELECT COURSE_ID FROM ENROLLMENT WHERE STUDENT_ID LIKE STUDENTID);
  IF PREREQ_CHECK>0 THEN
      ISSUE := 'ENROLLMENT ERROR : STUDENT HAS NOT TAKEN ALL PREREQUISITE COURSES';
      SUCCESS :=1;
      RETURN;
    END IF;
    
  INSERT INTO PENDING_PERMISSIONS("COURSE_ID","STUDENT_ID") VALUES(COURSEID,STUDENTID);
  SUCCESS := 2;
  ISSUE := 'SPECIAL PERMISSION REQUEST SENT TO DEPARTMENT';
  
  END IF;
  
END ISENROLLABLE;